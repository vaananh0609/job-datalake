name: 1AM Crawl (Max 1 Hour)

on:
  schedule:
    # 18:00 UTC = 01:00 Sáng Việt Nam (hôm sau)
    - cron: '0 18 * * *'
  # Có thể bấm nút chạy thử ngay lập tức nếu muốn
  workflow_dispatch:

jobs:
  run-crawlers:
    runs-on: ubuntu-latest
    # Cấu hình Matrix để chạy song song 2 file cùng lúc
    strategy:
      fail-fast: false # Nếu 1 file lỗi/hết giờ, file kia vẫn chạy tiếp
      matrix:
        script: [crawl_vietnamworks.py, crawl_joboko.py, crawl_topcv.py]

    steps:
    - name: Checkout code
      uses: actions/checkout@v4

    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.9'

    - name: Install libraries
      run: |
        python -m pip install --upgrade pip
        # Cài các thư viện cần thiết dựa trên code của bạn
        pip install requests pymongo playwright python-dotenv
        # Cài trình duyệt cho Playwright (cần cho file TopCV)
        playwright install chromium

    - name: Run Crawler with Timeout
      # Giới hạn 90 phút
      timeout-minutes: 90 
      env:
        MONGO_URI: ${{ secrets.MONGO_URI }}
      run: python ${{ matrix.script }}
